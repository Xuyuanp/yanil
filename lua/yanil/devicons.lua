local default_devicons = {
    ai = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    awk = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    bash = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    bat = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    bmp = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    c = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    cc = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    clj = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    cljc = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    cljs = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    coffee = {
        hl = {
            ctermfg = '94',
            guifg = '#905532',
        },
        icon = '',
    },
    conf = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    cp = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    cpp = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    cs = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    csh = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    css = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    cxx = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    d = {
        hl = {
            ctermfg = '124',
            guifg = '#AE403F',
        },
        icon = '',
    },
    dart = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    db = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    diff = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    dump = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    edn = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    eex = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    ejs = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    elm = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    erl = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    ex = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    exs = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    fsharp = {
        hl = {
            ctermfg = '30',
            guifg = '#44788E',
        },
        icon = '',
    },
    fish = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    fs = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    fsi = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    fsscript = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    fsx = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    gemspec = {
        icon = '',
    },
    gif = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    go = {
        hl = {
            ctermfg = '215',
            guifg = '#7FD6E9',
        },
        icon = '',
    },
    h = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    haml = {
        icon = '',
    },
    hbs = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    hrl = {
        hl = {
            ctermfg = '167',
            guifg = '#CB6F6F',
        },
        icon = '',
    },
    hs = {
        hl = {
            ctermfg = '215',
            guifg = '#F5C06F',
        },
        icon = '',
    },
    htm = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    html = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    hxx = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    ico = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    ini = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    java = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    jl = {
        hl = {
            ctermfg = '97',
            guifg = '#9558B2',
        },
        icon = '',
    },
    jpeg = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    jpg = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    js = {
        hl = {
            ctermfg = '215',
            guifg = '#F5C06F',
        },
        icon = '',
    },
    json = {
        hl = {
            ctermfg = '215',
            guifg = '#F5C06F',
        },
        icon = '',
    },
    jsx = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    ksh = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    leex = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    less = {
        hl = {
            ctermfg = '30',
            guifg = '#44788E',
        },
        icon = '',
    },
    lhs = {
        hl = {
            ctermfg = '215',
            guifg = '#F5C06F',
        },
        icon = '',
    },
    lua = {
        hl = {
            guifg = '#51A0CF',
        },
        icon = '',
    },
    markdown = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    md = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    mdx = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    mjs = {
        hl = {
            ctermfg = '215',
            guifg = '#F5C06F',
        },
        icon = '',
    },
    ml = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = 'λ',
    },
    mli = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = 'λ',
    },
    mustache = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    nix = {
        icon = '',
    },
    php = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    pl = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    pm = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    png = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    pp = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    ps1 = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    psb = {
        hl = {
            ctermfg = '30',
            guifg = '#44788E',
        },
        icon = '',
    },
    psd = {
        hl = {
            ctermfg = '30',
            guifg = '#44788E',
        },
        icon = '',
    },
    py = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    pyc = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    pyd = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    pyo = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    r = {
        icon = 'ﳒ',
    },
    rake = {
        icon = '',
    },
    rb = {
        hl = {
            ctermfg = '124',
            guifg = '#AE403F',
        },
        icon = '',
    },
    rlib = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    rmd = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    rproj = {
        icon = '鉶',
    },
    rs = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    rss = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    sass = {
        hl = {
            ctermfg = '167',
            guifg = '#CB6F6F',
        },
        icon = '',
    },
    scala = {
        hl = {
            ctermfg = '124',
            guifg = '#AE403F',
        },
        icon = '',
    },
    scss = {
        hl = {
            ctermfg = '167',
            guifg = '#CB6F6F',
        },
        icon = '',
    },
    sh = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    slim = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    sln = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    sql = {
        hl = {
            ctermfg = '30',
            guifg = '#44788E',
        },
        icon = '',
    },
    styl = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    suo = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    swift = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    t = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    tex = {
        icon = 'ﭨ',
    },
    toml = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    ts = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    tsx = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    twig = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    vim = {
        hl = {
            ctermfg = '107',
            guifg = '#8FAA54',
        },
        icon = '',
    },
    vue = {
        hl = {
            ctermfg = '36',
            guifg = '#42B883',
        },
        icon = '﵂',
    },
    webmanifest = {
        icon = '',
    },
    webp = {
        hl = {
            ctermfg = '50',
            guifg = '#3AFFDB',
        },
        icon = '',
    },
    xcplayground = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    xul = {
        hl = {
            ctermfg = '202',
            guifg = '#F16529',
        },
        icon = '',
    },
    yaml = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    yml = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    zsh = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    procfile = {
        hl = {
            ctermfg = '96',
            guifg = '#834F79',
        },
        icon = '',
    },
    docker = {
        hl = {
            ctermfg = '73',
            guifg = '#689FB6',
        },
        icon = '',
    },
    fav = {
        hl = {
            ctermfg = '214',
            guifg = '#F09F17',
        },
        icon = '',
    },
    license = {
        hl = {
            ctermfg = '231',
            guifg = '#FFFFFF',
        },
        icon = '',
    },
    gitlab = {
        hl = {
            ctermfg = '172',
            guifg = '#D4843E',
        },
        icon = '',
    },
    excel = {
        hl = {
            guifg = '#146C32',
        },
        icon = '',
    },
    word = {
        hl = {
            guifg = '#025CB9',
        },
        icon = '',
    },
    ppt = {
        hl = {
            guifg = '#B62B16',
        },
        icon = '',
    },
    txt = {
        hl = {
            guifg = '#FFFFFF',
        },
        icon = '',
    },
}

local exact_matches = {
    ['.bashprofile'] = 'bash',
    ['.bashrc'] = 'bash',
    ['.profile'] = 'bash',
    ['.zshrc'] = 'zsh',
    ['zprofile'] = 'zsh',
    ['.zprofile'] = 'zsh',
    ['.zlogin'] = 'zsh',
    ['.zshenv'] = 'zsh',
    ['vimrc'] = 'vim',
    ['.vimrc'] = 'vim',
    ['.gvimrc'] = 'vim',
    ['_vimrc'] = 'vim',
    ['_gvimrc'] = 'vim',
    ['rakefile'] = 'rake',
    ['config.ru'] = 'rb',
    ['gemfile'] = 'rb',
    ['.gitattributes'] = 'conf',
    ['.gitconfig'] = 'conf',
    ['.gitignore'] = 'conf',
    ['.dockerignore'] = 'conf',
    ['.env'] = 'conf',
    ['cmakelists.txt'] = 'conf',
    ['makefile'] = 'conf',
    ['.ds_store'] = 'conf',
    ['procfile'] = 'procfile',
    ['docker-compose.yml'] = 'docker',
    ['dockerfile'] = 'docker',
    ['favicon.ico'] = 'fav',
    ['license'] = 'license',
    ['.gitlab-ci.yml'] = 'gitlab',
    ['go.mod'] = 'conf',
    ['go.sum'] = 'conf',
}

local extension_aliases = {
    ru = 'rb',
    ['f#'] = 'fsharp',
    ['c++'] = 'cpp',
    hpp = 'h',
    hh = 'h',
    xls = 'excel',
    xlsx = 'excel',
    doc = 'word',
    docx = 'word',
    ppt = 'ppt',
    pptx = 'ppt',
}

-- local exact_matches = {
--     dropbox = {
--         hl = {
--             ctermfg = "73",
--             guifg = "#689FB6"
--         },
--         icon = ""
--     },
--     ["gruntfile.coffee"] = {
--         hl = {
--             ctermfg = "214",
--             guifg = "#F09F17"
--         },
--         icon = ""
--     },
--     ["gruntfile.js"] = {
--         hl = {
--             ctermfg = "214",
--             guifg = "#F09F17"
--         },
--         icon = ""
--     },
--     ["gruntfile.ls"] = {
--         hl = {
--             ctermfg = "214",
--             guifg = "#F09F17"
--         },
--         icon = ""
--     },
--     ["gulpfile.coffee"] = {
--         hl = {
--             ctermfg = "167",
--             guifg = "#CB6F6F"
--         },
--         icon = ""
--     },
--     ["gulpfile.js"] = {
--         hl = {
--             ctermfg = "167",
--             guifg = "#CB6F6F"
--         },
--         icon = ""
--     },
--     ["gulpfile.ls"] = {
--         hl = {
--             ctermfg = "167",
--             guifg = "#CB6F6F"
--         },
--         icon = ""
--     },
--     ["mix.lock"] = {
--         hl = {
--             ctermfg = "231",
--             guifg = "#FFFFFF"
--         },
--         icon = ""
--     },
--     node_modules = {
--         hl = {
--             ctermfg = "107",
--             guifg = "#8FAA54"
--         },
--         icon = ""
--     },
-- }

local vim = vim
local api = vim.api

local M = {}

local function highlight_define(ft, ctermfg, guifg)
    ctermfg = ctermfg or 'NONE'
    guifg = guifg or 'NONE'
    local name = string.format('YanilDevicons_%s', ft)
    local cmd = string.format('silent hi %s ctermfg=%s guifg=%s', name, ctermfg, guifg)
    api.nvim_command(cmd)
end

function M.setup_highlight()
    for ft, cfg in pairs(default_devicons) do
        if cfg.hl then
            highlight_define(ft, cfg.hl.ctermfg, cfg.hl.guifg)
        end
    end
end

function M.setup(_opts)
    M.setup_highlight()
    api.nvim_command('augroup yanil_devicons_highlight')
    api.nvim_command('autocmd!')
    api.nvim_command("autocmd ColorScheme * lua require('yanil/devicons').setup_highlight()")
    api.nvim_command('augroup end')
end

local function check_specials(name)
    if vim.endswith(name, 'rc') then
        return 'conf'
    end
end

function M.get(name, ext, opts)
    opts = opts or {}
    ext = ext ~= '' and ext or nil
    ext = exact_matches[name:lower()] or ext
    ext = extension_aliases[ext] or ext
    ext = ext or check_specials(name)
    local cfg = default_devicons[ext]
    if cfg then
        return cfg.icon, string.format('YanilDevicons_%s', ext)
    end
    if opts.default then
        return '', 'Normal'
    end
end

function M.decorator()
    return function(node)
        if not node.parent then
            local text = 'פּ'
            return text, 'YanilTreeDirectory'
        end
        if node:is_dir() then
            local text = node.is_open and '' or ''
            return text, node:is_link() and 'YanilTreeLink' or 'YanilTreeDirectory'
        end

        local icon, hl = M.get(node.name, node.extension)
        if icon then
            return icon, hl
        end

        return ''
    end
end

return M
